{% extends "_layout.njk" %}
{% block headerModifierClass %}page-header--overlap{% endblock %}
{% block headline %}Application dashboard{% endblock %}
{% block lede %}See how your branch is performing in recruitment, relative to others in the region and the country.{% endblock %}
{% block main %}

<main class="block block--bottom-margin">
    <h2 class="block__title">{% if sortQuery === "soonest" %}Upcoming interviews{% else %}Recent applicants{% endif %}{% if page > 1 %}, page {{ page }}{% endif %}</h2>

    <form class="applicants-filters">
        <label for="branch" class="visually-hidden">Branches to display</label>
        <select class="applicants-filters__select" name="branch">
            <option value="" {% if branchQuery === "" %}selected{% endif %}>All branches</option>
            <option value="leeds" {% if branchQuery === "leeds" %}selected{% endif %}>Leeds</option>
            <option value="sheffield" {% if branchQuery === "sheffield" %}selected{% endif %}>Sheffield</option>
            <option value="manchester" {% if branchQuery === "manchester" %}selected{% endif %}>Manchester</option>
        </select>

        <label for="sort" class="visually-hidden">Sort results</label>
        <select class="applicants-filters__select" name="sort">
            <option value="" {% if sortQuery === "" %}selected{% endif %}>Sort by newest</option>
            <option value="soonest" {% if sortQuery === "soonest" %}selected{% endif %}>Sort by soonest interview</option>
        </select>
    </form>

    <table class="applicants-table">
        <thead>
            <tr>
                <th scope="col" >Name</th>
                <th scope="col" class="with-tooltip" title="The branch this person wants to volunteer at">Chosen branch</th>
                <th scope="col" class="with-tooltip" title="When this person filled in the online form">Applied</th>
                <th scope="col" class="with-tooltip" title="The time and date of the interview this person booked">Interview</th>
            </tr>
        </thead>
        <tbody>
            {% for applicant in applicants %}
                <tr>
                    <td scope="row"><a href="/applicant/{{applicant.enquiryId}}">{{applicant.firstName}} {{applicant.lastName}}</a></td>
                    <td>{{applicant.branchId}}</td>
                    <td>{% if applicant.applicationTime %}{{ applicant.applicationTime | timeTo }}{% endif %}</td>
                    <td>{% if applicant.booking.startTime %}{{ applicant.booking.startTime | prettyDate }}{% endif %}</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="pagination">
        {% if page > 1 %} <a class="button pagination__button pagination__button--previous" onclick="window.location='/page/{{page - 1}}'+window.location.search;">Previous</a>{% endif %}   
        {% if not lastPage %}<a class="button pagination__button pagination__button--next" onclick="window.location='/page/{{page + 1}}'+window.location.search;">Next</a>{% endif %}
    </div>

</main>

{% endblock %}